ScreenManager:
    Screen:
        name: 'menu'

        MDCard:
            size_hint: None, None
            size: 600, 400
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            elevation: 5
            padding: 25
            spacing: 25
            orientation: 'vertical'

            MDLabel:
                text: 'Vaccination Record App'
                font_size: 45
                halign: 'center'

            MDFillRoundFlatButton:
                text: 'New/Edit Person'
                font_size: 30
                pos_hint: {'center_x': 0.5,}
                size: 0, 60
                size_hint: None, None
                increment_width: 80
                on_press:
                    root.current = 'new_person'
                    root.transition.direction = 'left'
                    app.clear_new_person_screen()

            MDFillRoundFlatButton:
                text: 'New Vaccination'
                font_size: 30
                pos_hint: {'center_x': 0.5,}
                size: 0, 60
                size_hint: None, None
                increment_width: 80
                on_press:
                    root.current = 'new_vaccination'
                    root.transition.direction = 'left'
                    app.clear_new_vaccination_screen()

            MDFillRoundFlatButton:
                text: 'Review Vaccinations'
                font_size: 30
                pos_hint: {'center_x': 0.5,}
                size: 0, 60
                size_hint: None, None
                on_press:
                    root.current = 'review_vaccinations'
                    root.transition.direction = 'left'

            MDFillRoundFlatButton
                text: 'Flag Vaccine Lot'
                font_size: 30
                pos_hint: {'center_x': 0.5,}
                size: 0, 60
                size_hint: None, None
                increment_width: 85
                on_press:
                    root.current = 'flag_vaccine_lot'
                    root.transition.direction = 'left'
    Screen:
        name: 'new_person'

        MDCard:
            size_hint: None, None
            size: 600, 400
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            elevation: 5
            padding: 25
            spacing: 25
            orientation: 'vertical'

            MDBoxLayout:
                orientation: 'vertical'

                MDLabel:
                    text: 'Create A New Person'
                    font_size: 30

                MDLabel:
                    text: 'To edit a person put their Patient ID in the textfield'
                    font_size: 20
                    color: 0, 0, 0, .5

                MDTextField:
                    id: name_entry_new_person
                    font_size: 30
                    hint_text: 'Name'
                    multiline: False
                    focus_next: patient_id_entry_new_person
                    write_tab: False


                MDTextField:
                    hint_text: 'Patient ID'
                    id: patient_id_entry_new_person
                    font_size: 30
                    multiline: False
                    focus_next: month_entry_new_person
                    write_tab: False

                MDLabel:
                    text: 'Date of Birth'
                    font_size: 20

                MDBoxLayout:
                    orientation: 'horizontal'

                    MDTextField:
                        hint_text: 'MM'
                        id: month_entry_new_person
                        font_size: 30
                        multiline: False
                        focus_next: day_entry_new_person
                        input_filter: 'int'
                        write_tab: False

                    MDTextField:
                        hint_text: 'DD'
                        id: day_entry_new_person
                        font_size: 30
                        multiline: False
                        focus_next: year_entry_new_person
                        input_filter: 'int'
                        write_tab: False
                    MDTextField:
                        hint_text: 'YYYY'
                        id: year_entry_new_person
                        font_size: sp(40)
                        multiline: False
                        input_filter: 'int'
                        write_tab: False

        MDBoxLayout:
            orientation: 'vertical'

            MDBoxLayout:
                orientation: 'horizontal'
                spacing: 25
                size_hint: None, None
                size: self.minimum_size
                pos_hint: {'center_x': 0.5,}

                MDRaisedButton:
                    text: 'Cancel'
                    font_size: 30
                    on_press:
                        root.current = 'menu'
                        root.transition.direction = 'right'

                MDRaisedButton:
                    text: 'Confirm'
                    font_size: 30
                    on_press:
                        app.create_new_person()

            Widget:
                size_hint_y: None
                height: 20

    Screen:
        name: 'new_vaccination'

        MDCard:
            size_hint: None, None
            size: 600, 400
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            elevation: 5
            padding: 25
            spacing: 25
            orientation: 'vertical'

            MDBoxLayout:
                orientation: 'vertical'

                MDLabel:
                    text: 'Select existing lot or create a new one'
                    font_size: 45
                    halign: 'center'

                Spinner:
                    id: lot_dropdown
                    font_size: 30
                    text: 'Select Lot'
                    background_color: 0, 1.5, 4, 1

        MDBoxLayout:
            orientation: 'vertical'

            MDBoxLayout:
                orientation: 'horizontal'
                spacing: 25
                size_hint: None, None
                size: self.minimum_size
                pos_hint: {'center_x': 0.5,}

                MDRaisedButton:
                    text: 'Cancel'
                    font_size: 30
                    on_press:
                        root.current = 'menu'
                        root.transition.direction = 'right'

                MDRaisedButton:
                    text: 'Create new Lot'
                    font_size: 30
                    on_press:
                        root.current = 'new_lot'
                        root.transition.direction = 'left'
                        app.clear_new_lot_screen()

                MDRaisedButton:
                    text: 'Continue'
                    font_size: 30
                    on_press:
                        root.current = 'new_vaccination_continued'
                        root.transition.direction = 'left'

            Widget:
                size_hint_y: None
                height: 20

    Screen:
        name: 'new_lot'

        MDCard:
            size_hint: None, None
            size: 600, 400
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            elevation: 5
            padding: 25
            spacing: 25
            orientation: 'vertical'

            MDBoxLayout:
                orientation: 'vertical'

                MDLabel:
                    text: 'Select a vaccine'
                    font_size: 30

                Spinner:
                    id: new_lot_vaccine_dropdown
                    text: 'Select an existing vaccine'
                    font_size: 30
                    background_color: 0, 1.5, 4, 1

                MDTextField:
                    hint_text: 'Enter Lot ID'
                    id: lot_id_entry_new_lot
                    font_size: 30
                    multiline: False
                    focus_next: month_entry_new_person
                    input_filter: 'int'
                    write_tab: False

                MDLabel:
                    text: 'Manufacture Date'
                    font_size: 30

                MDBoxLayout:
                    orientation: 'horizontal'
                    MDTextField:
                        hint_text: 'MM'
                        id: month_entry_new_lot
                        font_size: 30
                        multiline: False
                        focus_next: day_entry_new_lot
                        input_filter: 'int'
                        write_tab: False

                    MDTextField:
                        hint_text: 'DD'
                        id: day_entry_new_lot
                        font_size: 30
                        multiline: False
                        focus_next: year_entry_new_lot
                        input_filter: 'int'
                        write_tab: False

                    MDTextField:
                        hint_text: 'YYYY'
                        id: year_entry_new_lot
                        font_size: 30
                        multiline: False
                        input_filter: 'int'
                        write_tab: False

        MDBoxLayout:
            orientation: 'vertical'

            MDBoxLayout:
                orientation: 'horizontal'
                spacing: 25
                size_hint: None, None
                size: self.minimum_size
                pos_hint: {'center_x': 0.5,}

                MDRaisedButton:
                    text: 'Cancel'
                    font_size: 30
                    on_press:
                        root.current = 'menu'
                        root.transition.direction = 'right'

                MDRaisedButton:
                    text: 'Confirm'
                    font_size: 30
                    on_press:
                        app.create_new_lot()
                        app.lot_confirmed()

            Widget:
                size_hint_y: None
                height: 20

    Screen:
        name: 'new_vaccination_continued'

        MDCard:
            size_hint: None, None
            size: 600, 400
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            elevation: 5
            padding: 25
            spacing: 25
            orientation: 'vertical'

            MDBoxLayout:
                orientation: 'vertical'

                MDLabel:
                    text: 'New Vaccination'
                    font_size: 45

                MDTextField:
                    hint_text: 'Name'
                    id: name_input_new_vaccination
                    font_size: 30
                    multiline: False
                    focus_next: month_entry_new_person
                    write_tab: False

                MDTextField:
                    hint_text: 'Temperature \N{DEGREE SIGN}C'
                    id: temperature_input_new_vaccination
                    font_size: 30
                    multiline: False
                    input_filter: 'float'
                    focus_next: month_entry_new_person
                    write_tab: False

                MDLabel:
                    text: 'Vaccination Date'
                    font_size: 20

                MDBoxLayout:
                    orientation: 'horizontal'

                    MDTextField:
                        hint_text: 'MM'
                        id: month_entry_new_vaccination
                        font_size: 30
                        multiline: False
                        focus_next: day_entry_new_vaccination
                        input_filter: 'int'
                        write_tab: False

                    MDTextField:
                        hint_text: 'DD'
                        id: day_entry_new_vaccination
                        font_size: 30
                        multiline: False
                        focus_next: year_entry_new_vaccination
                        input_filter: 'int'
                        write_tab: False

                    MDTextField:
                        hint_text: 'YYYY'
                        id: year_entry_new_vaccination
                        font_size: sp(40)
                        multiline: False
                        input_filter: 'int'
                        write_tab: False

                MDRaisedButton:
                    text: 'Confirm'
                    font_size: 30
                    on_press:
                        app.create_vaccination_record()

        MDBoxLayout:
            orientation: 'vertical'

            MDBoxLayout:
                orientation: 'horizontal'
                spacing: 25
                size_hint: None, None
                size: self.minimum_size
                pos_hint: {'center_x': 0.5,}

                MDRaisedButton:
                    text: 'Cancel'
                    font_size: 30
                    on_press:
                        root.current = 'menu'
                        root.transition.direction = 'right'

                MDRaisedButton:
                    text: 'Back'
                    font_size: 30
                    on_press:
                        root.current = 'new_vaccination'
                        root.transition.direction = 'right'

            Widget:
                size_hint_y: None
                height: 20


    Screen:
        name: 'new_person_confirmed'

        MDCard:
            size_hint: None, None
            size: 600, 400
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            elevation: 5
            padding: 25
            spacing: 25
            orientation: 'vertical'

            MDBoxLayout:
                orientation: 'vertical'

                MDLabel:
                    text: 'Success!'
                    font_size: 60
                    halign: 'center'

                MDLabel:
                    text: 'A new person as been created'
                    font_size: 30
                    halign: 'center'

                MDLabel:
                    text: 'Would you like to record a vaccine for this person now?'
                    font_size: 30
                    halign: 'center'

        MDBoxLayout:
            orientation: 'vertical'

            MDBoxLayout:
                orientation: 'horizontal'
                spacing: 25
                size_hint: None, None
                size: self.minimum_size
                pos_hint: {'center_x': 0.5,}

                MDRaisedButton:
                    text: 'Yes'
                    font_size: 30
                    on_press:
                        app.clear_new_vaccination_screen()
                        app.fill_in_person_name_new_vaccination()
                        root.current = 'new_vaccination'
                        root.transition.direction = 'left'

                MDRaisedButton:
                    text: 'Not right now'
                    font_size: 30
                    on_press:
                        root.current = 'menu'
                        root.transition.direction = 'right'

            Widget:
                size_hint_y: None
                height: 20

    Screen:
        name: 'new_vaccination_confirmed'

        MDCard:
            size_hint: None, None
            size: 600, 400
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            elevation: 5
            padding: 25
            spacing: 25
            orientation: 'vertical'

            MDBoxLayout:
                orientation: 'vertical'

                MDLabel:
                    text: 'Success!'
                    font_size: 60
                    halign: 'center'

                MDLabel:
                    text: 'Vaccination Recorded'
                    font_size: 30
                    halign: 'center'

                MDLabel:
                    text: 'Would you like to record another vaccination?'
                    font_size: 30
                    halign: 'center'

        MDBoxLayout:
            orientation: 'vertical'

            MDBoxLayout:
                orientation: 'horizontal'
                spacing: 25
                size_hint: None, None
                size: self.minimum_size
                pos_hint: {'center_x': 0.5,}

                MDRaisedButton:
                    text: 'Yes'
                    font_size: 30
                    on_press:
                        root.current = 'new_vaccination'
                        root.transition.direction = 'left'

                MDRaisedButton:
                    text: 'Not right now'
                    font_size: 30
                    on_press:
                        root.current = 'menu'
                        root.transition.direction = 'right'

            Widget:
                size_hint_y: None
                height: 20

    Screen:
        name: 'person_updated'

        MDCard:
            size_hint: None, None
            size: 600, 400
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            elevation: 5
            padding: 25
            spacing: 25
            orientation: 'vertical'

            MDBoxLayout:
                orientation: 'vertical'

                MDLabel:
                    text: 'Success!'
                    font_size: 60
                    halign: 'center'

                MDLabel:
                    text: 'This person has been updated'
                    font_size: 30
                    halign: 'center'

                MDLabel:
                    text: 'Would you like to record a vaccine for this person now?'
                    font_size: 30
                    halign: 'center'

        MDBoxLayout:
            orientation: 'vertical'

            MDBoxLayout:
                orientation: 'horizontal'
                spacing: 25
                size_hint: None, None
                size: self.minimum_size
                pos_hint: {'center_x': 0.5,}

                MDRaisedButton:
                    text: 'Yes'
                    font_size: 30
                    on_press:
                        app.clear_new_vaccination_screen()
                        app.fill_in_person_name_new_vaccination()
                        root.current = 'new_vaccination'
                        root.transition.direction = 'left'

                MDRaisedButton:
                    text: 'Not right now'
                    font_size: 30
                    on_press:
                        root.current = 'menu'
                        root.transition.direction = 'right'

            Widget:
                size_hint_y: None
                height: 20

    Screen:
        name: 'review_vaccinations'

        MDCard:
            size_hint: None, None
            size: 600, 400
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            elevation: 5
            padding: 25
            spacing: 25
            orientation: 'vertical'

            MDLabel:
                text: 'Review Vaccinations'
                font_size: 45
                halign: 'center'

            MDTextField:
                hint_text: 'Patient ID'
                font_size: '30'
                id: patient_id_review_vaccinations

        MDBoxLayout:
            orientation: 'vertical'

            MDBoxLayout:
                orientation: 'horizontal'
                spacing: 25
                size_hint: None, None
                size: self.minimum_size
                pos_hint: {'center_x': 0.5,}

                MDRaisedButton:
                    text: 'Back'
                    font_size: 30
                    on_press:
                        root.current = 'menu'
                        root.transition.direction = 'right'

                MDRaisedButton:
                    text: 'Get Records'
                    font_size: 30
                    on_press:
                        app.get_vaccination_record(patient_id_review_vaccinations.text)

            Widget:
                size_hint_y: None
                height: 20

    Screen:
        name: 'review_vaccinations_continued'

        MDCard:
            size_hint: None, None
            size: 600, 400
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            elevation: 5
            padding: 25
            spacing: 25
            orientation: 'vertical'

            MDLabel:
                text: 'Review Vaccinations'
                font_size: 45
                halign: 'center'

            ScrollView:
                do_scroll_x: False
                do_scroll_y: True

                MDBoxLayout:
                    orientation: 'vertical'
                    size_hint: 1, None
                    height: sum(child.height+10 for child in self.children)
                    id: scrollview_review_vaccinations

        MDBoxLayout:
            orientation: 'vertical'

            MDBoxLayout:
                orientation: 'horizontal'
                spacing: 25
                size_hint: None, None
                size: self.minimum_size
                pos_hint: {'center_x': 0.5,}

                MDRaisedButton:
                    text: 'Back'
                    font_size: 30
                    on_press:
                        root.current = 'review_vaccinations'
                        root.transition.direction = 'right'
                        app.clear_vaccination_records()

                MDRaisedButton:
                    text: 'New Vaccination'
                    font_size: 30
                    on_press:
                        root.current = 'new_vaccination'
                        root.transition.direction = 'left'
                        app.clear_new_vaccination_screen()
                        app.new_vaccination_from_review()
                        app.clear_vaccination_records()

            Widget:
                size_hint_y: None
                height: 20

    Screen:
        name: 'flag_vaccine_lot'

        MDCard:
            size_hint: None, None
            size: 600, 400
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            elevation: 5
            padding: 25
            spacing: 25
            orientation: 'vertical'

            MDLabel:
                text: 'Flag Vaccine Lot'
                font_size: 45
                halign: 'center'

            Spinner:
                id: lot_dropdown
                font_size: 30
                text: 'Select Lot'
                background_color: 0, 1.5, 4, 1
                pos_hint: {'center_x': 0.5,}

            ScrollView:
                do_scroll_x: False
                do_scroll_y: True

                MDBoxLayout:
                    orientation: 'vertical'
                    size_hint: 1, None
                    height: sum(child.height+10 for child in self.children)
                    id: scrollview_flag_vaccine_lot

        MDBoxLayout:
            orientation: 'vertical'

            MDBoxLayout:
                orientation: 'horizontal'
                spacing: 25
                size_hint: None, None
                size: self.minimum_size
                pos_hint: {'center_x': 0.5,}

                MDRaisedButton:
                    text: 'Done'
                    font_size: 30
                    on_press:
                        root.current = 'menu'
                        root.transition.direction = 'right'

            Widget:
                size_hint_y: None
                height: 20

<NewInputError@Popup>:
    title: 'Input Error'
    font_size: sp(30)
    size_hint: (None,None)
    size: (500,200)
    BoxLayout:
        orientation: 'vertical'
        Label:
            text: f'{app.input_error_message}'
            font_size: sp(15)
        Button:
            text: 'Okay'
            font_size: sp(30)
            on_press:
                root.dismiss()

<MatchingIDError@Popup>:
    title: 'Input Error'
    font_size: sp(30)
    size_hint: (None,None)
    size: (500,350)
    BoxLayout:
        orientation: 'vertical'
        Label:
            text: 'Patient with this patient ID already exists. \nWould you like to update this person with \nthe current values in the entry boxes?'
            font_size: sp(18)
        Button:
            text: 'Yes'
            font_size: sp(30)
            on_press:
                app.update_person()
                root.dismiss()
        Button:
            text: 'No thanks'
            font_size: sp(30)
            on_press:
                root.dismiss()
